<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.2 Pairwise Did Primer | Commercio Developers Guide</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Guide to Commercio Developers">
    <link rel="preload" href="/assets/css/0.styles.9bcdb81a.css" as="style"><link rel="preload" href="/assets/js/app.b2876222.js" as="script"><link rel="preload" href="/assets/js/2.23eb20b9.js" as="script"><link rel="preload" href="/assets/js/28.ca5b1245.js" as="script"><link rel="prefetch" href="/assets/js/10.972d1cef.js"><link rel="prefetch" href="/assets/js/11.c09e1769.js"><link rel="prefetch" href="/assets/js/12.bd346232.js"><link rel="prefetch" href="/assets/js/13.9036412d.js"><link rel="prefetch" href="/assets/js/14.fdd8af01.js"><link rel="prefetch" href="/assets/js/15.294b90fc.js"><link rel="prefetch" href="/assets/js/16.0dc6aa1d.js"><link rel="prefetch" href="/assets/js/17.942cbeb6.js"><link rel="prefetch" href="/assets/js/18.d017c5dc.js"><link rel="prefetch" href="/assets/js/19.f997ddc8.js"><link rel="prefetch" href="/assets/js/20.88d64e2f.js"><link rel="prefetch" href="/assets/js/21.57a51132.js"><link rel="prefetch" href="/assets/js/22.9726c6e0.js"><link rel="prefetch" href="/assets/js/23.b9f74242.js"><link rel="prefetch" href="/assets/js/24.6cd11514.js"><link rel="prefetch" href="/assets/js/25.dc816cc5.js"><link rel="prefetch" href="/assets/js/26.2b377f55.js"><link rel="prefetch" href="/assets/js/27.99a1dc68.js"><link rel="prefetch" href="/assets/js/29.4f3d30d4.js"><link rel="prefetch" href="/assets/js/3.56670d0e.js"><link rel="prefetch" href="/assets/js/30.0dc733b7.js"><link rel="prefetch" href="/assets/js/31.6ddd6eea.js"><link rel="prefetch" href="/assets/js/32.496d4033.js"><link rel="prefetch" href="/assets/js/33.a2f17f79.js"><link rel="prefetch" href="/assets/js/34.d4cc0d31.js"><link rel="prefetch" href="/assets/js/35.5b19a0dd.js"><link rel="prefetch" href="/assets/js/36.6bc45276.js"><link rel="prefetch" href="/assets/js/37.5a1adc88.js"><link rel="prefetch" href="/assets/js/38.9d526bbb.js"><link rel="prefetch" href="/assets/js/39.47086d85.js"><link rel="prefetch" href="/assets/js/4.853d7076.js"><link rel="prefetch" href="/assets/js/40.3da422d7.js"><link rel="prefetch" href="/assets/js/41.65b2124f.js"><link rel="prefetch" href="/assets/js/42.94587897.js"><link rel="prefetch" href="/assets/js/43.7832c453.js"><link rel="prefetch" href="/assets/js/44.32cc7195.js"><link rel="prefetch" href="/assets/js/45.5d578c6e.js"><link rel="prefetch" href="/assets/js/46.2c44b260.js"><link rel="prefetch" href="/assets/js/47.4a78f798.js"><link rel="prefetch" href="/assets/js/48.592238bd.js"><link rel="prefetch" href="/assets/js/49.ea1c028f.js"><link rel="prefetch" href="/assets/js/5.d7fc651f.js"><link rel="prefetch" href="/assets/js/50.0780724b.js"><link rel="prefetch" href="/assets/js/6.25c4609c.js"><link rel="prefetch" href="/assets/js/7.abae30d2.js"><link rel="prefetch" href="/assets/js/8.7bee5608.js"><link rel="prefetch" href="/assets/js/9.0f0dcfa6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9bcdb81a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Commercio Developers Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/commercionetwork/commercio-developers-guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/commercionetwork/commercio-developers-guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1. Fundamentals</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2. Commercio Account</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3. Commercio ID</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/3-commercio-id/3.1-chapter.html" class="sidebar-link">3.1 DID, DDO and VC Primer</a></li><li><a href="/3-commercio-id/3.2-chapter.html" aria-current="page" class="active sidebar-link">3.2 Pairwise Did Primer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#tools" class="sidebar-link">Tools</a></li><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#functions-and-apis" class="sidebar-link">Functions and APIs</a></li><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#notations" class="sidebar-link">Notations</a></li><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#step-by-step-sequence" class="sidebar-link">Step by step sequence</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#_1-ddo-creation" class="sidebar-link">1 - DDO Creation</a></li><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#_2-send-tokens-to-the-tumbler" class="sidebar-link">2 - Send tokens to the Tumbler</a></li><li class="sidebar-sub-header"><a href="/3-commercio-id/3.2-chapter.html#_3-power-up-request" class="sidebar-link">3 - Power Up Request</a></li></ul></li></ul></li><li><a href="/3-commercio-id/3.3-chapter.html" class="sidebar-link">3.3 Create a Ddo</a></li><li><a href="/3-commercio-id/3.4-chapter.html" class="sidebar-link">3.4 Request Powerup</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4. Commercio Docs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5. Commercio Sign</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6. Commercio Mint</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>7. Commercio KYC</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-2-pairwise-did-primer"><a href="#_3-2-pairwise-did-primer" class="header-anchor">#</a> 3.2 Pairwise Did Primer</h1> <h2 id="tools"><a href="#tools" class="header-anchor">#</a> Tools</h2> <p>We will use the <em>Commercio SDK</em>, our own open source tool to format transactions to Commercio.network and the <em>Sacco</em> library, our own open source tool to sign and send transactions to any Cosmos SDK based blockchain, including Commercio.network.</p> <h2 id="functions-and-apis"><a href="#functions-and-apis" class="header-anchor">#</a> Functions and APIs</h2> <p>We will describe the system designed for the creation of pairwise identity.</p> <p>This required the functions described in the following chapters. In particular, the most relevant methods are:</p> <ul><li><a href="/3-commercio-id/3.3-chapter.html">Chapter 3.3</a>, IdHelper <em>setDidDocument</em>;</li> <li><a href="/3-commercio-id/3.4-chapter.html">Chapter 3.4</a>, IdHelper <em>requestDidPowerUp</em>.</li></ul> <h2 id="notations"><a href="#notations" class="header-anchor">#</a> Notations</h2> <table><thead><tr><th>Acronym</th> <th>Meaning</th></tr></thead> <tbody><tr><td><code>I PU</code></td> <td>Public Identity <code>I</code>.</td></tr> <tr><td><code>I DID</code></td> <td>Decentralized Identifier associated with the identity <code>I PU</code>.</td></tr> <tr><td><code>I DDO</code></td> <td>Did Document associated with the <code>I DID</code>. Contains the Signature key and Encryption key associated with  <code>I PU</code>.</td></tr> <tr><td><code>I VC</code></td> <td>Verifiable credentials associated with <code>I PU</code>. <code>I</code> controls other accounts which it will use to activate Pairwise Identity with its interlocutors. These identities are indicated with IPW1, IPW2 ... IPWn, all complete with the related Did Documents.</td></tr> <tr><td><code>T</code></td> <td>Service that sells packages of cash and offers the possibility, upon indication of a public account detected, to carry out the power up of the accounts in a coupled way. <code>T</code> also has a public and verified account: <code>T DID</code>, <code>T DDO</code> and <code>T VC</code> from Government.</td></tr> <tr><td><code>C</code></td> <td>Challenge, calculated by <code>I</code>, in order to indicate a unique quantity (collision-free).</td></tr></tbody></table> <h2 id="step-by-step-sequence"><a href="#step-by-step-sequence" class="header-anchor">#</a> Step by step sequence</h2> <h3 id="_1-ddo-creation"><a href="#_1-ddo-creation" class="header-anchor">#</a> <strong>1 - DDO Creation</strong></h3> <p>First you need to create a <code>I DDO</code> associated with to <code>I DID</code> (<a href="/3-commercio-id/3.3-chapter.html">Chapter 3.3</a>).</p> <h3 id="_2-send-tokens-to-the-tumbler"><a href="#_2-send-tokens-to-the-tumbler" class="header-anchor">#</a> <strong>2 - Send tokens to the Tumbler</strong></h3> <p>The second step is to send the tokens (<a href="/2-commercio-account/2.9-chapter.html">Chapter 2.9</a>) to the public address of the centralized entity <code>T</code>.</p> <h3 id="_3-power-up-request"><a href="#_3-power-up-request" class="header-anchor">#</a> <strong>3 - Power Up Request</strong></h3> <p>Only after you send the tokens to <code>T</code>, finally you can create a Did power up request (<a href="/3-commercio-id/3.4-chapter.html">Chapter 3.4</a>).</p> <h4 id="_3-1-step-by-step"><a href="#_3-1-step-by-step" class="header-anchor">#</a> <strong>3.1 - Step by step</strong></h4> <p><strong>-</strong> <code>I</code> will create a JSON (<code>signature_json</code>) containing the following information:</p> <div class="language- extra-class"><pre><code>```json
{
  &quot;sender_did&quot;: &quot;&lt;User did&gt;&quot;,
  &quot;pairwise_did&quot;: &quot;&lt;Pairwise Did address to power up&gt;&quot;,
  &quot;timestamp&quot;: &quot;&lt;Timestamp&gt;&quot;
}
```
</code></pre></div><p><strong>-</strong> <code>I</code> retrive the Did of <code>T</code> using public endpoint <code>/government/tumbler</code> or by command <code>cncli query government tumbler-address</code>.</p> <p><strong>-</strong> <code>I</code> retrive the public key of <code>T</code> resolving its DDO.</p> <p><strong>-</strong> <code>I</code> calculate SHA-256 <code>hash</code> of <code>sender_did</code>, <code>pairwise_did</code> and <code>timestamp</code> concatenation.</p> <p><strong>-</strong> <code>I</code> get <code>sign(hash)</code> signing in format PKCS1v15 the <code>hash</code> with the RSA private key associated to RSA public key inserted in the DDO.</p> <p><strong>-</strong> <code>I</code> convert <code>sign(hash)</code> in Base64 notation <code>base64(sign(hash))</code> and use it to add <code>signature</code> field.</p> <p><strong>-</strong> <code>I</code> create a <code>payload</code> JSON made as follow:</p> <div class="language- extra-class"><pre><code>```json

{
  &quot;sender_did&quot;: &quot;&lt;User did&gt;&quot;,
  &quot;pairwise_did&quot;: &quot;&lt;Pairwise Did to power up&gt;&quot;,
  &quot;timestamp&quot;: &quot;&lt;Timestamp&gt;&quot;,
  &quot;signature&quot;: &quot;base64(sign(hash))&quot;,
}

```
</code></pre></div><p><strong>-</strong> <code>I</code> create a random AES-256 key <code>F</code>.</p> <p><strong>-</strong> <code>I</code> generate a random 96-bit nonce <code>N</code>.</p> <p><strong>-</strong> <code>I</code> encrypt the <code>payload</code> using the <code>F</code> AES-256 key.</p> <ol><li><code>I</code> remove all the white spaces and line ending characters.</li> <li><code>I</code> encrypt the resulting string bytes using <code>F</code>, obtaining <code>ciphertext</code>. Note that the AES encryption method must be <code>AES-GCM</code>.</li> <li><code>I</code> concatenate bytes of <code>ciphertext</code> and <code>N</code> and encode the resulting bytes using the Base64 encoding method, obtaining <code>proof</code>.</li></ol> <p><strong>-</strong> <code>I</code> encrypt the AES-256 key.</p> <ol><li><code>I</code> Encrypt the <code>F</code> key bytes using the centralized system's RSA public key using PKCS1v15 mode.</li> <li><code>I</code> Encode the resulting bytes using the Base64 encoding method, obtaining <code>proof_key</code>.</li></ol> <p><strong>-</strong> <code>I</code> will create the transaction message as follows:</p> <div class="language- extra-class"><pre><code>```json
{
  &quot;type&quot;: &quot;commercio/MsgRequestDidPowerUp&quot;,
  &quot;value&quot;: {
    &quot;claimant&quot;: &quot;&lt;Address of the Did to fund&gt;&quot;,
    &quot;amount&quot;: [
      {
        &quot;amount&quot;: &quot;&lt;Amount of coins to be sent&gt;&quot;,
        &quot;denom&quot;: &quot;&lt;Denom of the coin to send&gt;&quot;
      }   
    ],
    &quot;proof&quot;: &quot;&lt;proof&gt;&quot;,
    &quot;id&quot;: &quot;&lt;uuid&gt;&quot;,
    &quot;proof_key&quot;: &quot;&lt;proof_key&gt;&quot;
  }
}
```
</code></pre></div><p><strong>-</strong> <code>I</code> will send a transaction of the <code>MsgRequestDidPowerUp</code> type.</p> <div class="language- extra-class"><pre><code>```golang
type MsgRequestDidPowerUp struct {
  Claimant sdk.AccAddress `json:&quot;claimant&quot;`
  Amount   sdk.Coins      `json:&quot;amount&quot;`
  Proof    string         `json:&quot;proof&quot;`
  ID       string         `json:&quot;id&quot;`
  ProofKey string         `json:&quot;proof_key&quot;`
}
```
</code></pre></div><blockquote><p><strong>Claimant</strong> is the public Did of who made the request (therefore the Signer of MsgRequirePowerupDid)</p> <p><strong>Amount</strong> is the quantity sent in the powerup request</p> <p><strong>Proof</strong> is the proof sent in the powerup request</p></blockquote> <p><strong>-</strong> <code>T</code> will be constantly listening for new transactions of the type described above. Once a new transaction is observed, it will decrypt the <code>proof_key</code> using its own private decryption key, obtaining<code>F</code> key.</p> <p><strong>-</strong> <code>T</code> will decrypt the <code>payload</code> using<code>aes_key</code> and it will get <code>I DDO</code> through the <code>I DID</code> contained within the transaction</p> <p><strong>-</strong> <code>T</code> will extract the public signature key of <code>I</code> from the obtained <code>I DDO</code> and it will verify the signature contained in the payload</p> <p><strong>-</strong> <code>T</code> will verify that  <code>I</code>  has sent a transferable amount of funds equal to or greater than that indicated in the transaction.</p> <p><strong>-</strong> If the transfer can be performed correctly, <code>T</code> will perform an on-chain transaction containing two messages:</p> <div class="language- extra-class"><pre><code>```golang
type MsgSend struct {
  FromAddress sdk.AccAddress `json:&quot;from_address&quot; yaml:&quot;from_address&quot;`
  ToAddress   sdk.AccAddress `json:&quot;to_address&quot; yaml:&quot;to_address&quot;`
  Amount      sdk.Coins      `json:&quot;amount&quot; yaml:&quot;amount&quot;`
}

type MsgChangePowerUpStatus struct {
  Recipient sdk.AccAddress `json:&quot;recipient&quot;`
  PowerUpID string         `json:&quot;id&quot;`
  Status    RequestStatus  `json:&quot;status&quot;`
  Signer    sdk.AccAddress `json:&quot;signer&quot;`
}
```
</code></pre></div><blockquote><p><strong>Status</strong> has the value <code>approved</code></p></blockquote> <p><strong>-</strong> If the transfer cannot be performed correctly, <code>T</code> will perform an on-chain transaction with this message:</p> <div class="language- extra-class"><pre><code>```golang
type MsgChangePowerUpStatus struct {
  Recipient sdk.AccAddress `json:&quot;recipient&quot;`
  PowerUpID string         `json:&quot;id&quot;`
  Status    RequestStatus  `json:&quot;status&quot;`
  Signer    sdk.AccAddress `json:&quot;signer&quot;`
}
```
</code></pre></div><blockquote><p><strong>Status</strong> has the value <code>rejected</code></p> <p><strong>Signer</strong> is the public <code>T DID</code></p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/commercionetwork/commercio-developers-guide/edit/master/3-commercio-id/3.2-chapter.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/26/2020, 1:50:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/3-commercio-id/3.1-chapter.html" class="prev">
        3.1 DID, DDO and VC Primer
      </a></span> <span class="next"><a href="/3-commercio-id/3.3-chapter.html">
        3.3 Create a Ddo
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b2876222.js" defer></script><script src="/assets/js/2.23eb20b9.js" defer></script><script src="/assets/js/28.ca5b1245.js" defer></script>
  </body>
</html>
